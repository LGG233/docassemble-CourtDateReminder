mandatory: True
code: |
  allow_cron = True
  multi_user = True
---
initial: True
code: |
  process_action()
---
code: |
  time_request_set = current_datetime()
---
question: |
  How much of a delay for the email?
fields:
  - Delay (in hours): time_delay
    datatype: number
---
question: |
  What is your e-mail address?
fields:
  - E-mail: email_address
    datatype: email
---
mandatory: True
question: |
  Ok, I'll e-mail you at ${ email_address} 1 hour
  from ${ format_time(time_request_set) }.
buttons:
  Leave: leave
---
template: reminder_email
subject: |
  Hey, it's been 1 hour since ${ format_time(time_request_set) }.
content: |
  Don't forget about that thing you need to do!
---
event: cron_hourly
code: |
  if task_not_yet_performed('1 hour delay') and date_difference(starting=time_request_set.hour, ending=current_datetime().hour)== 0:
    send_email(to=email_address, template=reminder_email, task='1 hour delay')
  response()
---